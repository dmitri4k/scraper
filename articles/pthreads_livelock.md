## Livelock

Лайвлок (livelock) – ситуация, при которой два или более потока не могут выполнять полезной работы по 
причине борьбы за общий ресурс. От дедлока 
ситуация отличается тем, что потоки не просто ждут, но безуспешно пытаются выйти из состояния ступора (поэтому live, а не dead).

Самый простой пример – два вежливых сотрудника, которые идут по коридору навстречу друг другу. В тот момент, когда они встречаются, 
то первый отходит вправо от себя, второй, в свою очередь, отходит влево от себя. Они опять друг напротив друга. Первый тогда отходит влево, 
а второй вправо, но они опять оказываются друг у друга на пути. В реальной жизни такая ситуация быстро исправится, но (глупый) компьютер 
может делать это бесконечно.

Давайте рассмотрим нашу задачу обедающих философов. Начнём с ситуации с дедлоком, но попробуем разрешить её другим способом. Изменим 
алгоритм поведения философов.

Первый философ, вежливый, берёт левую вилку. В том случае, если правая вилка занята, то он кладёт левую вилку обратно и немного ждёт, после 
чего опять пытается взять левую вилку.

Пусть первый взял левую вилку. Второй, третий, четвёртый и пятый сделали то же самое. Первый уже не может взять правую (которая является левой у второго философа), чешет затылок  и решает положить вилку обратно. Но таким же образом поступают и все остальные философы. Первый кладёт левую вилку обратно, так поступают и все остальные. Теперь все философы сидят без вилок. Первый философ берёт левую вилку, второй берёт левую вилку и т.д.
Рассмотрим реализацию такой ситуации:

В чём именно здесь проблема, очевидно. Абсолютная одинаковость действий философов не позволяет им выйти из порочного круга. 
Нарушение симметричности действий компенсируется функцией Sleep, которая сглаживает неодинаковость времени выполнения всех 
остальных инструкций.

Для того чтобы решить ситуацию, достаточно сделать так, чтобы действия философов отличались, например, заставив их спать случайное 
время. Добавим новый Sleep после разблокировки мьютекса (после того, как положил левую вилку обратно):

В данном случае ещё добавлена переменная counter, которая показывает, сколько раз пообедал философ.
Это решение можно назвать спорным, - задача статьи была показать, когда может возникнуть ситуация лайвлока.

![mail.png](../images/mail.png)

