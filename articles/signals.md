## Сигналы

Сигналы – это ограниченная форма межпроцессного взаимодействия. Сигнал – это асинхронное
уведомление, отосланное процессу или определённому потоку процесса для того, чтобы сообщить ему о каком-то событии.

Работа с сигналами хорошо развита в UNIX-подобных операционных системах. Стандарт си определяет всего шесть сигналов, которые могут быть обработаны.

Кроме того, есть сигналы, которые не могут быть обработаны, пойманы или игнорированы.

Для обработки сигналов в библиотеке signals.h определены функции

Эта функция принимает в качестве аргумента сигнал и указатель на void функцию, которая принимает сигнал. Функция возвращает указатель на функцию, которая была перед этим задана в качестве обработчика. Если функция отработала с ошибкой, то она вернёт значение SIGERR.

В качестве обработчика можно задать два предопределённых значения

Для того, чтобы из программы послать сигнал, используется функция

Если функция отработала успешно, то возвращается 0, иначе ненулевое значение.

Такое объяснение довольно запутанно. Посмотрим простой пример.

Вызов и обработка сигнала внутри одного процесса являются синхронными. То есть, при посылке сигнала управление переходит к обработчику, новых потоков не создаётся. После того, как отработал обработчик, управление возвращается тому, кто послал сообщение.

Немного переделаем программу, чтобы она стала цивильнее

Теперь сделаем следующее – напишем три обработчика. Каждый будет устанавливать следующий.

Более интересный пример: будем читать чужую память, пока не выпадет Access Violation:

К большому сожалению, восстановить программу после такой ошибки по стандарту не получится (только используя системные функции, специфичные для ОС). После того, как был послан сигнал SIGSEGV он будет обработан функцией listener. Но после этого управление вернётся к функции main и будет выполнена та инструкция, которая приведёт к access violation. В этом случае максимум, что мы можем сделать штатными средствами – попытаться сохранить состояние программы и вывести сообщение о сбое.

Вот ещё пример обработки сигнала: программа работает бесконечно долго, пока не получит сигнал SIGINT

Теперь программа будет работать до тех пор, пока не будет нажато сочетание Ctrl+C. Тем не менее, можно игнорировать этот сигнал:

Этот процесс всегда можно остановить сочетанием Ctrl+Break (SIGSTOP) или просто убить.

![mail.png](../images/mail.png)

