## Поллинг статуса файла

Отслеживание состояния файла и содержимого папки важная задача. Например, необходимо
обновлять сервер при изменении конфигурационного файла, чистить кеш при изменении или
добавлении новых файлов, оповещать о внесённых изменения и т.п. На различных ОС оптимальная реализация
решения этой задачи будет различной. Кроссплатформенная библиотека libuv предоставляет два
метода для мониторинга состояния файловой системы - поллинг и отслеживание событий файловой системы.

Поллинг – это процесс периодического опроса. В библиотеке libuv есть множество методов для работы с таймером и очередями, однако отдельно выделен метод опроса состояния файла.
Поллинг состоит из нескольких шагов

Для инициализации обработчика используется функция

которая принимает, как обычно, цикл и указатель на handle – обработчик типа uv_fs_poll_t

Для старта используется функция

принимающая инициализированный хэндл, указатель на функцию обработчик, строку с именем файла и число миллисекунд (интервал опроса). В различных ОС  интервал меньше секунды может не восприниматься.



Функция обработчик имеет сигнатуру

Два аргумента prev и curr – это статус файла, предыдущий, и текущий (после произошедшего обновления). 
О статусе файла см. предыдущий раздел.

Для остановки процесса воспользуйтесь функцией

Пример поллинга

После запуска программы изменяйте файл - меняйте содержимое, имя, удаляйте. Программа будет отслеживать изменение файла.

События файловой системы платформозависимы. Библиотека даёт обёртку, которая позволяет писать кроссплатформенный код, 
но ограничивает функционал.

Реализация детектирования событий (создание, изменение или удаление файлов) происходит наилучшим для данной ОС способом. Т.е., если нет иной возможности, то обработка событий скатывается к процессу поллинга.

Работа с событиями похожа на работу с поллингом. Сначала инициализируется хэндл, потом указывается директория, за которой следит  обработчик. После этого обработку событий можно отключить.

Инициализация производится с помощью функции

Для старта процесс

где filename – имя папки, изменения в которой будут отслеживаться. Здесь флаги flags могут приниматься одно из значений перечисления

По умолчанию можно оставлять флаг равным нулю.

Колбэк имеет следующую сигнатуру

Он принимает имя файла, изменения которого были отмечены, и тип изменения (флаг events). Ип изменение – одно из значений перечисления

Для остановки воспользуйтесь функцей

Пример отслеживания событий

Эта программа мониторит папку C:/c. Изменение содержимого папки будет отображаться на экране.

![mail.png](../images/mail.png)

